/*! grafana - v2.1.3 - 2015-08-24
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache License */

define(["helpers","plugins/datasource/kairosdb/datasource"],function(a){"use strict";describe("KairosDBDatasource",function(){var b=new a.ServiceTestContext;beforeEach(module("grafana.services")),beforeEach(b.providePhase(["templateSrv"])),beforeEach(b.createService("KairosDBDatasource")),beforeEach(function(){b.ds=new b.service({url:""})}),describe("When querying kairosdb with one target using query editor target spec",function(){var a,c="/api/v1/datapoints/query",d={metrics:[{name:"test"}],cache_time:0,start_relative:{value:"1",unit:"hours"}},e={range:{from:"now-1h",to:"now"},targets:[{metric:"test",downsampling:"(NONE)"}]},f={queries:[{sample_size:60,results:[{name:"test",values:[[14200704e5,1]]}]}]};beforeEach(function(){b.$httpBackend.expect("POST",c,d).respond(f),b.ds.query(e).then(function(b){a=b}),b.$httpBackend.flush()}),it("should generate the correct query",function(){b.$httpBackend.verifyNoOutstandingExpectation()}),it("should return series list",function(){expect(a.data.length).to.be(1),expect(a.data[0].target).to.be("test")})})})});